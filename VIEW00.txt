
--Aylara göre sırlama yapan sql sorgusu

CREATE VIEW WM_AYLARA_GORE_SIRALAMA
AS
select
DATEPART(YEAR, O.DATE_) YIL, DATEPART(MONTH, O.DATE_) AY, SUM(AMOUNT) TOPMIKTAR, COUNT(OD.ID) URUNSAYISI

from ORDERDETAILS OD
INNER JOIN ORDERS O ON OD.ORDERID=O.ID
INNER JOIN ITEMS ITM ON OD.ITEMID=ITM.ID
INNER JOIN USERS U ON U.ID=O.USERID
INNER JOIN ADDRESS A ON A.ID=O.ADDRESSID
INNER JOIN COUNTRIES C ON C.ID=A.COUNTRYID
INNER JOIN CITIES CT  ON CT.ID=A.CITYID	
INNER JOIN TOWNS TW	ON TW.ID=A.TOWNID
INNER JOIN PAYMENTS P ON P.ORDERID=O.ID

GROUP BY DATEPART(YEAR, O.DATE_) , DATEPART(MONTH, O.DATE_) 