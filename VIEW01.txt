-- Oluşturulan VIEW tablosunu düzenleme

ALTER VIEW WM_AYLARA_GORE_SIRALAMA
AS
SELECT
DATEPART(YEAR, O.DATE_) YIL,
CASE 
	WHEN DATEPART(MONTH, O.DATE_)=1 THEN 'OCK'
	WHEN DATEPART(MONTH, O.DATE_)=2 THEN 'SBT'
	WHEN DATEPART(MONTH, O.DATE_)=3 THEN 'MRT'
	WHEN DATEPART(MONTH, O.DATE_)=4 THEN 'NSN'
END AS AY, 
SUM(AMOUNT) TOPMIKTAR, COUNT(OD.ID) URUNSAYISI

FROM ORDERDETAILS OD
INNER JOIN ORDERS O ON OD.ORDERID=O.ID
INNER JOIN ITEMS ITM ON OD.ITEMID=ITM.ID
INNER JOIN USERS U ON U.ID=O.USERID
INNER JOIN ADDRESS A ON A.ID=O.ADDRESSID
INNER JOIN COUNTRIES C ON C.ID=A.COUNTRYID
INNER JOIN CITIES CT  ON CT.ID=A.CITYID	
INNER JOIN TOWNS TW	ON TW.ID=A.TOWNID
INNER JOIN PAYMENTS P ON P.ORDERID=O.ID

GROUP BY DATEPART(YEAR, O.DATE_) , DATEPART(MONTH, O.DATE_) 